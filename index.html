<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Olugboye Feranmi Birthday Guestbook</title>
<style>
body { font-family: Arial, sans-serif; padding: 20px; background: #fffbe6; }
h1 { color: #ff6f61; text-align: center; }
form { margin-bottom: 20px; background: #fff3e0; padding: 15px; border-radius: 10px; max-width: 400px; margin: auto; }
input, textarea, button { display: block; width: 100%; margin-bottom: 10px; padding: 8px; font-size: 1em; border-radius: 5px; border: 1px solid #ccc; }
canvas { border: 1px solid #ccc; display: block; margin-bottom: 10px; }
#messages { max-width: 600px; margin: auto; }
.message { background: #15b820; border: 1px solid #a3ff99; padding: 10px; border-radius: 8px; margin-bottom: 10px; }
</style>
</head>
<body>

<h1>Welcome to my Birthday Guestbook</h1>

<form id="guestbookForm">
  <input type="text" id="name" placeholder="Name" required>
  <textarea id="wish" placeholder="Birthday Wish" rows="3" required></textarea>
  <canvas id="signature" width="300" height="100"></canvas>
  <button type="button" id="clearCanvas">Clear Signature</button>
  <button type="submit">Submit</button>
</form>

<h2 style="text-align:center;">Drop a message for me</h2>
<div id="messages"></div>

<script>
  const API_KEY = "$2a$10$FKS1xapYRR4LZQXFFWujpugfAsuAWBVvKuTNcfcQReZcgtz.9RTrC";
  const BIN_ID = "68fdee84ae596e708f2da104";

  const form = document.getElementById('guestbookForm');
  const nameInput = document.getElementById('name');
  const wishInput = document.getElementById('wish');
  const messagesDiv = document.getElementById('messages');
  const canvas = document.getElementById('signature');
  const ctx = canvas.getContext('2d');

  // Canvas drawing
  let drawing = false;
  canvas.addEventListener('mousedown', () => drawing = true);
  canvas.addEventListener('mouseup', () => drawing = false);
  canvas.addEventListener('mouseleave', () => drawing = false);
  canvas.addEventListener('mousemove', draw);

  function draw(e) {
    if (!drawing) return;
    ctx.lineWidth = 2;
    ctx.lineCap = 'round';
    ctx.strokeStyle = '#000';
    ctx.beginPath();
    ctx.moveTo(e.offsetX, e.offsetY);
    ctx.lineTo(e.offsetX, e.offsetY);
    ctx.stroke();
  }

  document.getElementById('clearCanvas').addEventListener('click', () => {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
  });

  async function loadMessages() {
    try {
      const res = await fetch(`https://api.jsonbin.io/v3/b/${BIN_ID}/latest`, {
        headers: { "X-Master-Key": API_KEY }
      });
      const data = await res.json();
      const messages = data.record || [];
      messagesDiv.innerHTML = '';
      messages.forEach(m => {
        const div = document.createElement('div');
        div.className = 'message';
        div.innerHTML = `<strong>${m.name}</strong> says:<br>${m.wish.replace(/\n/g,'<br>')}<br><img src="${m.signature}" width="300">`;
        messagesDiv.appendChild(div);
      });
    } catch (err) {
      console.error("Error loading messages:", err);
    }
  }

  form.addEventListener('submit', async e => {
    e.preventDefault();
    const signatureData = canvas.toDataURL();
    const newMessage = {
      name: nameInput.value,
      wish: wishInput.value,
      signature: signatureData
    };

    try {
      // Get current messages
      const res = await fetch(`https://api.jsonbin.io/v3/b/${BIN_ID}/latest`, {
        headers: { "X-Master-Key": API_KEY }
      });
      const data = await res.json();
      const messages = data.record || [];
      messages.push(newMessage);

      // Update bin
      await fetch(`https://api.jsonbin.io/v3/b/${BIN_ID}`, {
        method: "PUT",
        headers: {
          "Content-Type": "application/json",
          "X-Master-Key": API_KEY
        },
        body: JSON.stringify(messages)
      });

      // Reset form and canvas
      form.reset();
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      loadMessages();
    } catch (err) {
      console.error("Error saving message:", err);
    }
  });

  loadMessages();
</script>
</body>
</html>
